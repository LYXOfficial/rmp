import{j as e,ag as Y,M as Z,ah as K,J as q,K as X,L as Q,h as Ms,ai as at,N as w,B as _,aj as Ce,ak as Ne,T as ne,al as re,b as oe,q as es,t as R,O as me,am as lt,an as ct,ao as ye,R as A,ap as N,Q as Gs,aq as fs,ar as js,a2 as ee,as as bs,at as ce,x as le,au as ss,av as dt,aw as Ws,a8 as Us,e as $s,w as Fs,m as Vs,E as Js,ax as ze,a7 as Re,a1 as ht,ay as pt,az as ut,aA as W,aB as _s,aC as gt,aD as k,aE as C,aF as xt,k as mt,W as ie,U as ft,V as jt}from"./chakra-Bbq65mY9.js";import{u as bt,r as T,C as wt,M as ws,L as Ys,n as cs,S as H,R as As,a as Zs,b as O,c as B,d as D,e as St,f as yt,g as Ct,h as zt,i as ke,E as _e,s as vt,j as Je,k as ts,m as kt,l as Ts,o as Mt,p as Ss,q as J,t as $,v as se,w as Ks,x as qs,y as ds,z as Me,A as Le,B as Os,D as Rs,F as _t,G as At,H as Tt,I as Ot,J as Rt,K as Es,N as Et,O as Nt,P as It,Q as Ht,T as Lt,U as Pt,V as Dt,W as Bt,X as Gt,Y as Wt,Z as Ut,_ as $t,$ as Ft,a0 as Vt,a1 as Jt,a2 as Yt,a3 as $e,a4 as Zt,a5 as fe,a6 as Kt,a7 as qt,a8 as Xt,a9 as Qt,aa as ue,ab as en,ac as sn,ad as Ns,ae as tn,af as ns,ag as nn,ah as rn,ai as on,aj as an,ak as ln,al as cn,am as dn,an as hn,ao as pn,ap as un}from"./index-DaSf5Fzj.js";import{u as L,b as f,a as Fe,T as Is}from"./react-DsCD0OwY.js";import{d as hs,m as gn,a as xn,i as mn,s as fn,u as ys,M as jn}from"./master-manager-BNFsurIE.js";import{C as bn}from"./change-type-modal-TfOCEapl.js";var Hs=function(s){return bt(T.ready(),s)},wn={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Sn=s=>{const{isOpen:a,onClose:i}=s,{t}=L(),o=T.getAppVersion();return e.jsxs(Y,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:t("header.about.title")}),e.jsx(X,{}),e.jsxs(Q,{paddingBottom:10,children:[e.jsxs(Ms,{direction:"row",children:[e.jsx(at,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(Ms,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(w,{fontSize:"xl",as:"b",children:t("header.about.rmp")}),e.jsx(w,{children:o}),e.jsx(w,{}),e.jsx(w,{fontSize:"sm",children:t("header.about.railmapgen")})]})]}),e.jsx(_,{margin:5,children:e.jsx(w,{fontSize:"xl",children:t("header.about.desc")})}),e.jsx(Ce,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contributors")}),e.jsx(Ce,{as:"h6",size:"xs",my:2,children:t("header.about.coreContributors")}),e.jsxs(Ne,{children:[e.jsxs(ne,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(re,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(w,{fontSize:"sm",children:t("header.about.content1")}),e.jsx(w,{fontSize:"sm",align:"right",mb:1,children:t("header.about.content2")})]})]}),e.jsxs(ne,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(re,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(w,{fontSize:"sm",children:t("header.about.langonginc")}),e.jsx(w,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(Ce,{as:"h6",size:"xs",my:2,children:t("header.about.styleContributors")}),e.jsxs(Ne,{children:[e.jsxs(ne,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(re,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(w,{fontSize:"sm",mb:1,children:t("header.about.203IhzElttil")})]})]}),e.jsxs(ne,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[e.jsx(re,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),e.jsx(w,{fontSize:"sm",mb:1,children:t("header.about.Swiftiecott")})]})]}),e.jsxs(ne,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[e.jsx(re,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),e.jsx(w,{fontSize:"sm",mb:1,children:t("header.about.Minwtraft")})]})]})]}),e.jsx(Ce,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contactUs")}),e.jsxs(Ne,{children:[e.jsxs(ne,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(re,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.github")}),e.jsx(w,{fontSize:"sm",children:t("header.about.githubContent")})]})]}),e.jsxs(ne,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(re,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.slack")}),e.jsx(w,{fontSize:"sm",children:t("header.about.slackContent")}),e.jsx(w,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(Ce,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.donation.title")}),e.jsxs(Ne,{children:[e.jsxs(ne,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(re,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",pb:1,children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.afdian")}),e.jsx(w,{fontSize:"sm",children:t("header.donation.viaCNY")})]})]}),e.jsxs(ne,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(re,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",pb:1,children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.openCollective")}),e.jsx(w,{fontSize:"sm",children:t("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Pe(s){const a=s.sizes.shift(),i=Math.max(Math.ceil(a[0]),1),t=Math.max(Math.ceil(a[1]),1),o=[i-1,t-1,1,1],n=performance.now(),r=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let h,g;r?(h=new OffscreenCanvas(1,1),g=new OffscreenCanvas(i,t)):(h=document.createElement("canvas"),h.width=1,h.height=1,g=document.createElement("canvas"),g.width=i,g.height=t);const m=h.getContext("2d"),j=g.getContext("2d");j&&(j.fillRect.apply(j,o),m.drawImage(g,i-1,t-1,1,1,0,0,1,1));const l=m&&m.getImageData(0,0,1,1).data[3]!==0,c=parseInt(performance.now()-n);return[h,g].forEach(p=>{p.height=0,p.width=0}),r?(postMessage({width:i,height:t,testTime:c,isTestPass:l}),!l&&s.sizes.length&&setTimeout(()=>{Pe(s)},0)):l?s.onSuccess({width:i,height:t,testTime:c}):(s.onError({width:i,height:t,testTime:c}),s.sizes.length&&setTimeout(()=>{Pe(s)},0)),l}const rs={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},ve={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Ee={};function os(s){const a=s.width===s.height,i=s.height===1,t=s.width===1,o=[];if(!s.width||!s.height)s.sizes.forEach(n=>{const r=a||i?n:1,h=a||t?n:1;o.push([r,h])});else{const n=s.min||ve.min,r=s.step||ve.step;let h=Math.max(s.width,s.height);for(;h>=n;){const g=a||i?h:1,m=a||t?h:1;o.push([g,m]),h-=r}}return o}function Ve(s){const a=typeof window<"u",i=a&&"Promise"in window,t=a&&"HTMLCanvasElement"in window,o=a&&"OffscreenCanvas"in window,n=URL.createObjectURL(new Blob([])).slice(-36),r=performance.now(),{onError:h,onSuccess:g,...m}=s,j=()=>parseInt(performance.now()-r);let l=null;if(!t)return!1;if(s.useWorker&&o){const c="\n            var canvasTest = ".concat(Pe.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),p=new Blob([c],{type:"application/javascript"}),d=URL.createObjectURL(p);l=new Worker(d),URL.revokeObjectURL(d),l.onmessage=function(u){const{width:x,height:b,testTime:S,isTestPass:y}=u.data,M={width:x,height:b,testTime:S,totalTime:j()};y?(Ee[n].onSuccess(M),delete Ee[n]):Ee[n].onError(M)}}if(i)return new Promise(c=>{const p={...s,onError(d){let{width:u,height:x,testTime:b}=d;const S={width:u,height:x,testTime:b,totalTime:j()};let y;if(s.sizes.length===0)y=!0;else{const[[M,P]]=s.sizes.slice(-1);y=u===M&&x===P}h(S),y&&c({...S,success:!1})},onSuccess(d){let{width:u,height:x,testTime:b}=d;const S={width:u,height:x,testTime:b,totalTime:j()};g(S),c({...S,success:!0})}};if(l){const{onError:d,onSuccess:u}=p;Ee[n]={onError:d,onSuccess:u},l.postMessage(m)}else Pe(p)});if(l)Ee[n]={onError:h,onSuccess:g},l.postMessage(m);else return Pe(s)}const yn={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=os({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...rs.area]}),i={...ve,...s,sizes:a};return Ve(i)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=os({width:1,height:s.max,min:s.min,step:s.step,sizes:[...rs.height]}),i={...ve,...s,sizes:a};return Ve(i)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=os({width:s.max,height:1,min:s.min,step:s.step,sizes:[...rs.width]}),i={...ve,...s,sizes:a};return Ve(i)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={...ve,...s};return a.sizes=[...a.sizes],a.width&&a.height&&(a.sizes=[[a.width,a.height]]),Ve(a)}};var De=(s=>(s.left="l",s.right="r",s))(De||{}),be=(s=>(s.through="through",s.nonThrough="nonthrough",s))(be||{}),Ye=(s=>(s.local="local",s.express="express",s.direct="direct",s))(Ye||{}),ge=(s=>(s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro",s))(ge||{}),Cs=(s=>(s.sh="sh",s.sh2020="sh2020",s))(Cs||{});const de=new Set,ps=new Set,us=new Set,gs=new Set,Xs=new Map,xe=new Map,is=new Set,as=new Map,U=new Map;let I=[],Ie=0;const He=new Map,ls=new Map,xs=new Set,Cn={localisedName:{en:"LEFT END"},num:"00",services:[Ye.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:De.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},zn={localisedName:{en:"RIGHT END"},num:"00",services:[Ye.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:De.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},vn={},Qs={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:ge.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:De.right,platform_num:"1",theme:[wt.Shanghai,"sh1","#E3002B",ws.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:vn,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:Cs.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},kn={localisedName:{},num:"",services:[Ye.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:De.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},z=s=>"".concat(s[0],"/").concat(s[1],"=").concat(s[2]).concat(s[3]),zs=s=>Ys.has(s),Mn=s=>{if(zs(s.style))return structuredClone(s[s.style].color)},_n=(s,a)=>{const[i,t]=s.extremities(a),o=s.getEdgeAttributes(a),n=o.style;if(i!=t&&zs(n)){const r=Mn(o);gs.has(z(r))||(us.add(r),gs.add(z(r)),Xs.set(r,i),xe.set(z(r),new Set)),xe.get(z(r)).add(i),xe.get(z(r)).add(t),U.has(i)?I.push({target:t,next:U.get(i),color:r}):I.push({target:t,next:-1,color:r}),U.set(i,Ie),Ie++,U.has(t)?I.push({target:i,next:U.get(t),color:r}):I.push({target:i,next:-1,color:r}),U.set(t,Ie),Ie++}},et=(s,a,i)=>{if(xe.get(z(i)).has(s)){xe.get(z(i)).delete(s);for(let t=U.get(s);t!=-1;t=I[t].next){const o=I[t].target,n=I[t].color;z(n)==z(i)&&et(o,s,i)}}},st=(s,a,i)=>{if(de.has(s))return;de.add(s);let t=0;const o=new Set;for(let n=U.get(s);n!=-1;n=I[n].next){const r=I[n].target,h=I[n].color;z(h)==z(i)&&(o.has(r)||(o.add(r),t++,r!=a&&st(r,s,i)))}He.set(s,t)},Ls=(s,a)=>{const i=s.stn_list.lineend.parents;i.push(a),s.stn_list.lineend.parents=structuredClone(i).reverse(),s.stn_list.lineend.branch={...s.stn_list.lineend.branch,left:s.stn_list.lineend.parents.length==2?[be.through,i[1]]:void 0}},An=(s,a)=>{let i=0;for(let t=U.get(s);t!=-1;t=I[t].next){I[t].target;const o=I[t].color;z(o)==z(a)&&i++}return i},tt=(s,a,i)=>{if(xs.has(s))return[];xs.add(s);const t=[];for(let o=U.get(s);o!=-1;o=I[o].next){const n=I[o].target,r=I[o].color;n!=a&&z(r)==z(i)&&(n.startsWith("stn")?t.push(n):t.push(...tt(n,s,i)))}return t},ms=(s,a,i,t,o,n,r)=>{var c;if(de.has(s)&&(!s.startsWith("misc_node_")&&r.stn_list[s]==null||s.startsWith("misc_node_")&&!ps.has(s)||r.loop))return[];if(de.has(s)&&r.stn_list[s]!=null&&An(s,n)-1>=2){const p=[...r.stn_list[s].parents,a];if(r.stn_list[p[1]]==null){const x=p[0];p[0]=p[1],p[1]=x}r.stn_list[s].parents=structuredClone(p).reverse(),r.stn_list[s].branch={...r.stn_list[s].branch,left:[be.through,p[1]]};const d=[];for(const x of r.stn_list[s].children)x!=a&&d.push(x);r.stn_list[s].children=structuredClone(d),(c=r.stn_list[s].branch)==null||delete c.right;const u=[];for(const x of r.stn_list.lineend.parents)x!=s&&u.push(x);return r.stn_list.lineend.parents=structuredClone(u).reverse(),r.stn_list.lineend.branch={...r.stn_list.lineend.branch,left:r.stn_list.lineend.parents.length==2?[be.through,u[1]]:void 0},d.length==0&&(r.stn_list[s].children=["lineend"],Ls(r,s)),[s]}de.add(s);const h=[],g=[],m=[],j=new Set,l=new Set;for(let p=U.get(s);p!=-1;p=I[p].next){const d=I[p].target,u=I[p].color;if(d!=i){if(z(u)==z(n)){if(l.has(d))continue;if(l.add(d),s.startsWith("misc_node_")){const x=ms(d,a,s,t+1,o,n,r);x.length!=0&&h.push(...x)}else{const x=ms(d,s,s,t+1,o,n,r);x.length!=0&&h.push(...x)}}if(!j.has(z(u))&&z(u)!=z(n)){j.add(z(u));const x={theme:u,name:["ch_".concat(z(u)),"en_".concat(z(u))]};m.push(x)}}}if(h.length==2){for(let p=0;p<2;p++)h[p]=="lineend"&&h.splice(p,1);if(r.stn_list[h[1]].parents.length>=2){const p=h[0];h[0]=h[1],h[1]=p}}if(de.has(s)&&r.stn_list[s]!=null){const p=[];for(const d of r.stn_list.lineend.parents)d!=s&&p.push(d);r.stn_list.lineend.parents=structuredClone(p).reverse(),r.stn_list.lineend.branch={...r.stn_list.lineend.branch,left:r.stn_list.lineend.parents.length==2?[be.through,p[1]]:void 0},h.length==0&&(xs.clear(),g.push(...tt(s,a,n)))}if(s.startsWith("misc_node_"))return ps.add(s),h;{const p=o.getNodeAttributes(s).type,d=o.getNodeAttributes(s)[p];if(r.stn_list[s]=structuredClone(kn),r.stn_list[s].localisedName={zh:d.names[0],en:d.names[1]},r.stn_list[s].num=String(t),o.getNodeAttributes(s).type==H.GzmtrBasic){const u=d;r.stn_list[s].num=u.stationCode,(u.secondaryNames[0]!==""||u.secondaryNames[1]!=="")&&(r.stn_list[s].localisedSecondaryName={zh:u.secondaryNames[0],en:u.secondaryNames[1]})}if(o.getNodeAttributes(s).type==H.GzmtrInt){const u=d,x=u.transfer[0];for(const b of x)if(z(b)==z(n)){r.stn_list[s].num=String(b[5]);break}(u.secondaryNames[0]!==""||u.secondaryNames[1]!=="")&&(r.stn_list[s].localisedSecondaryName={zh:u.secondaryNames[0],en:u.secondaryNames[1]})}return h.length!=0?(r.stn_list[s].children=structuredClone(h).reverse(),h.length==2&&(r.stn_list[s].branch={...r.stn_list[s].branch,right:[be.through,h[1]]})):(r.stn_list[s].children=["lineend"],Ls(r,s)),g.push(a),r.stn_list[s].parents=structuredClone(g).reverse(),g.length==2&&(r.stn_list[s].branch={...r.stn_list[s].branch,left:[be.through,g[1]]}),m.length!=0&&(r.stn_list[s].transfer.groups[0].lines=structuredClone(m)),[s]}},Tn=(s,a,i,t)=>{const o=structuredClone(Qs);t=="LOOP"&&(o.loop=!0);let n;switch(s.getNodeAttributes(i).type){case H.GzmtrBasic:case H.GzmtrInt:n=ge.GZMTR;break;case H.MTR:n=ge.MTR;break;default:n=ge.SHMetro;break}o.theme=structuredClone(a),o.style=n,o.stn_list.linestart=structuredClone(Cn),o.stn_list.lineend=structuredClone(zn),de.clear(),ps.clear();const r=ms(i,"linestart","linestart",1,s,a,o);if(o.current_stn_idx=r[0],o.stn_list.linestart.children=[r[0]],!(Object.keys(o.stn_list).length<=3||o.stn_list.lineend.parents.length>=3))return structuredClone(o)},On=s=>{var t,o;de.clear(),us.clear(),gs.clear(),Xs.clear(),xe.clear(),is.clear(),as.clear(),U.clear(),I=[],Ie=0,He.clear(),ls.clear(),s.filterEdges(n=>n.startsWith("line")).forEach(n=>{zs(s.getEdgeAttributes(n).style)&&_n(s,n)});let a=0;s.forEachNode(n=>{ls.set(n,++a)}),ls.set("lineend",++a);const i=[];for(const n of us){let r=0;for(;xe.get(z(n)).size!=0;){let h="line_root";xe.get(z(n)).forEach(m=>{h=="line_root"&&(h=m)}),et(h,"line_root",n);const g={theme:n,index:++r};is.add(g),as.set(g,h)}}for(const n of is){const{theme:r}=n;de.clear(),He.clear(),st(as.get(n),"line_root",r);let h=!0,g="LINE";const m=[];for(const[l,c]of He)c==1&&m.push(l),c==3&&(g="BRANCH"),c>3&&(h=!1);if(!h)continue;m.length==0&&(g="LOOP",He.forEach((l,c)=>{m.push(c)}));const j=[];for(const l of m){const c=Tn(s,r,l,g);c!=null&&j.push([c,(t=c.stn_list[c.current_stn_idx].localisedName.zh)!=null?t:"",(o=c.stn_list[c.current_stn_idx].localisedName.en)!=null?o:""])}j.length!=0&&i.push({id:cs(10),theme:r,param:structuredClone(j),type:g})}return i},Rn=s=>s[0]!=""&&s[1]!=""?s[0]+"_"+s[1]:s[0]!=""?s[0]:s[1]!=""?s[1]:"".concat(new Date().valueOf()),En=(s,a)=>{let i=s;return a.forEach((t,o)=>{const n=new RegExp("ch_".concat(o),"g"),r=new RegExp("en_".concat(o),"g");i=i.replace(n,t[0]),i=i.replace(r,t[1])}),i},Nn=(s,a,i,t)=>{s.line_name=a,s.line_num=String(i),hs("RMG_".concat(Rn(a),".json"),"application/json",En(JSON.stringify(s),t))},In={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Hn=s=>{const{isOpen:a,onClose:i}=s,{t}=L(),o=f.useRef(window.graph),[n,r]=f.useState(!1),[h,g]=f.useState([[Qs,"",""]]),[m,j]=f.useState(["","",""]),[l,c]=f.useState(new Map),[p,d]=f.useState(new Map),[u,x]=f.useState([]);f.useEffect(()=>{if(a){const S=On(o.current),y=new Map;S.forEach(({id:M,theme:P})=>{y.set(z(P),M)}),x(S),c(y)}},[a]);const b=(S,y)=>document.getElementById("2RMG_"+y+"_"+S).value.trim();return e.jsxs(Y,{isOpen:a,onClose:i,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:e.jsx(w,{as:"b",fontSize:"xl",children:t("header.download.2rmg.title")})}),e.jsx(X,{}),e.jsxs(Q,{children:[e.jsx(w,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info1")}),e.jsx(w,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info2")}),e.jsx("br",{}),u.length===0?e.jsx(w,{fontSize:"md",children:t("header.download.2rmg.noline")}):e.jsx("table",{children:e.jsx("tbody",{children:u.map(({id:S,theme:y,param:M,type:P})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(As,{name:y[0]=="other"&&y[1]=="other"?y[2]:y[1],bg:y[2],fg:y[3]})}),e.jsx("td",{children:e.jsx(es,{placeholder:t("header.download.2rmg.placeholder.chinese"),id:"2RMG_nameCh_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(es,{placeholder:t("header.download.2rmg.placeholder.english"),id:"2RMG_nameEn_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(es,{placeholder:t("header.download.2rmg.placeholder.lineCode"),id:"2RMG_lineNum_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(As,{name:t("header.download.2rmg.type.".concat(P.toLowerCase())),bg:In[P],fg:ws.white})}),e.jsx("td",{children:e.jsx(R,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const G=b(S,"nameCh"),he=b(S,"nameEn"),te=b(S,"lineNum"),F=new Map;l.forEach((V,pe)=>{F.set(pe,[b(V,"nameCh"),b(V,"nameEn")])}),g(M),j([G,he,te]),d(F),r(!0)},size:"sm",children:e.jsx(Zs,{})})})]},S))})})]}),e.jsx(me,{children:e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:t("close")})})]}),e.jsx(Ln,{isOpen:n,onClose:()=>r(!1),param:h,nameList:m,interchangeName:p})]})},Ln=s=>{const{isOpen:a,onClose:i,param:t,nameList:o,interchangeName:n}=s,{t:r}=L(),[h,g]=f.useState("");return f.useEffect(()=>{o[0]!=""&&o[1]!=""?g(o[0]+"/"+o[1]):o[0]!=""?g(o[0]):o[1]!=""?g(o[1]):g("")},[...o]),e.jsxs(Y,{isOpen:a,onClose:i,size:"md",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:e.jsxs(w,{as:"b",fontSize:"xl",children:[r("header.download.2rmg.download")," ",h]})}),e.jsx(X,{}),e.jsx(Q,{children:e.jsxs(lt,{children:[e.jsx(w,{fontSize:"sm",mb:"2",lineHeight:"100%",children:r("header.download.2rmg.downloadInfo")}),t.map(([m,j,l])=>e.jsxs(R,{onClick:()=>{Nn(m,[o[0],o[1]],o[2],n)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[j.replaceAll("\n","⏎"),"/",l.replaceAll("\n","⏎")]},"".concat(j).concat(l)))]})}),e.jsx(me,{children:e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:r("close")})})]})]})},Pn=s=>{const{isOpen:a,onClose:i}=s,{t}=L();return e.jsxs(Y,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:t("header.download.termsAndConditions")}),e.jsx(X,{}),e.jsx(Q,{children:e.jsxs(ct,{children:[e.jsxs(ye,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(A,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(N,{as:O})]}),", ",e.jsxs(A,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(N,{as:O})]})," or ",e.jsxs(A,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(N,{as:O})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(A,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(N,{as:O})]}),"，",e.jsxs(A,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(N,{as:O})]}),"或",e.jsxs(A,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(N,{as:O})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(ye,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(N,{as:O})]})," and ",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(N,{as:O})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(N,{as:O})]}),"及",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(N,{as:O})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(ye,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(A,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(N,{as:O})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(A,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(N,{as:O})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(ye,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(ye,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(A,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(N,{as:O})]})," ","– the open-source emoji and icon project. License:",e.jsxs(A,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(N,{as:O})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(A,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(N,{as:O})]}),"所设计。许可证：",e.jsxs(A,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(N,{as:O})]})]}),e.jsxs(ye,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Dn(){const s=Gs("white","var(--chakra-colors-gray-800)"),a=B(),{telemetry:{project:i}}=D(v=>v.app),t=D(v=>v.param),o=T.isAllowAnalytics(),{t:n}=L(),r=f.useRef(window.graph),[h,g]=f.useState("png"),m={png:n("header.download.png"),svg:n("header.download.svg")},[j,l]=f.useState(2),[c,p]=f.useState({width:1,height:1,benchmark:.001}),[d,u]=f.useState(200),x=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],b=Object.fromEntries(x.map(v=>[v,"".concat(v,"%")])),[S,y]=f.useState([]),[M,P]=f.useState(!1),G=[{type:"select",label:n("header.download.format"),value:h,options:m,onChange:v=>g(v==="png"?"png":"svg")}],he=[{type:"select",label:n("header.download.svgVersion"),value:j,options:{1.1:n("header.download.svg1.1"),2:n("header.download.svg2")},onChange:v=>{l(v),v===1.1&&We(!0)}}],te=[{type:"select",label:n("header.download.scale"),value:d,options:b,disabledOptions:S,onChange:v=>u(v)},{type:"switch",label:n("header.download.transparent"),isChecked:M,onChange:P}],[F,V]=f.useState(!1),[pe,Be]=f.useState(!1),[Ge,We]=f.useState(!1),[Ae,Ze]=f.useState(!1),[E,nt]=f.useState(!1),[rt,vs]=f.useState(!1);f.useEffect(()=>{(async()=>{const Te=await yn.maxArea({usePromise:!0,useWorker:!0});p(Te)})()},[]),f.useEffect(()=>{if(F){const{xMin:v,yMin:Te,xMax:Ke,yMax:Ue}=St(r.current),[qe,we]=[Ke-v,Ue-Te],Oe=x.filter(Se=>qe*Se/100>c.width&&we*Se/100>c.height);y(Oe)}},[F]);const ot=()=>{o&&T.event(_e.DOWNLOAD_PARAM,i?{"#nodes":r.current.order,"#edges":r.current.size}:{}),hs("RMP_".concat(new Date().valueOf(),".json"),"application/json",vt(t))},it=async()=>{V(!1),o&&T.event(_e.DOWNLOAD_IMAGES,i?{numberOfNodes:r.current.order,numberOfEdges:r.current.size}:{});const{elem:v,width:Te,height:Ke}=await gn(r.current,Ae,Ge,j),Ue=v.outerHTML.replace(/&nbsp;/g," ");if(h==="svg"){hs("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Ue);return}document.body.appendChild(v);const qe="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Ue)));document.body.removeChild(v),v.remove();const we=document.createElement("canvas"),[Oe,Se]=[Te*d/100,Ke*d/100];we.width=Oe,we.height=Se;const Xe=we.getContext("2d");M||(Xe.fillStyle=s,Xe.fillRect(0,0,Oe,Se));const Qe=new Image;Qe.onload=()=>{setTimeout(()=>{Xe.drawImage(Qe,0,0,Oe,Se),we.toBlob(ks=>{if(!ks){a(Je({status:"error",message:n("header.download.imageTooBig")}));return}xn("RMP_".concat(new Date().valueOf(),".png"),ks)},"image/png")},mn()?2e3:0)},Qe.src=qe};return e.jsxs(fs,{id:"download",children:[e.jsx(js,{as:ee,size:"sm",variant:"ghost",icon:e.jsx(Zs,{})}),e.jsxs(bs,{children:[e.jsx(ce,{icon:e.jsx(yt,{}),onClick:ot,children:n("header.download.config")}),e.jsxs(ce,{icon:e.jsx(Ct,{}),onClick:()=>vs(!0),children:[n("header.download.2rmg.title"),e.jsx(le,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(ce,{icon:e.jsx(zt,{}),onClick:()=>V(!0),children:n("header.download.image")})]}),e.jsxs(Y,{size:"xl",isOpen:F,onClose:()=>V(!1),children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:n("header.download.image")}),e.jsx(X,{}),e.jsxs(Q,{children:[e.jsx(ke,{fields:G}),h==="svg"&&e.jsx(ke,{fields:he}),h==="png"&&e.jsx(ke,{fields:te}),h==="png"&&S.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(w,{as:"i",fontSize:"sm",children:n("header.download.disabledScaleOptions")}),e.jsx("br",{}),e.jsx(w,{as:"i",fontSize:"sm",children:n("header.download.disabledScaleOptionsWorkarounds")}),e.jsxs(A,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",e.jsx(N,{as:O})]}),e.jsx("br",{})]}),e.jsx("br",{}),e.jsx(ss,{isChecked:Ge,isDisabled:h==="svg"&&j===1.1,onChange:v=>We(v.target.checked),children:e.jsx(w,{children:n("header.download.useSystemFonts")})}),e.jsx(ss,{isChecked:Ae,onChange:v=>Ze(v.target.checked),children:e.jsxs(w,{children:[n("header.download.shareInfo1"),e.jsxs(A,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[n("header.about.rmp")," ",e.jsx(N,{as:O})]}),n("header.download.shareInfo2")]})}),e.jsx(ss,{isChecked:E,onChange:v=>nt(v.target.checked),children:e.jsxs(w,{children:[n("header.download.termsAndConditionsInfo"),e.jsxs(A,{color:"teal.500",onClick:()=>Be(!0),children:[n("header.download.termsAndConditions")," ",e.jsx(N,{as:O})]}),n("header.download.period")]})})]}),e.jsx(me,{children:e.jsx(dt,{children:e.jsx(R,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!E||h==="png"&&S.includes(d),onClick:it,children:n("header.download.confirm")})})}),e.jsx(Pn,{isOpen:pe,onClose:()=>Be(!1)})]})]}),e.jsx(Hn,{isOpen:rt,onClose:()=>vs(!1)})]})}const Bn=(s,{info_panel_type:a,line_num:i,stn_list:t,style:o,theme:n},r,h,g)=>{const m=Object.fromEntries(Object.keys(t).filter(c=>!["linestart","lineend"].includes(c)).map(c=>[c,"stn_".concat(cs(10))]));Object.entries(t).filter(([c,p])=>!["linestart","lineend"].includes(c)).forEach(([c,p])=>{const d=s.filterNodes((u,x)=>Object.values(H).includes(x.type)&&x[x.type].names[0]===p.localisedName.zh);d.length!==0&&(m[c]=d[0])});const j=[["linestart",-1,0]],l={};for(;j.length;){const[c,p,d]=j.shift();t[c].children.filter(x=>x!="lineend").forEach((x,b)=>{const S=Math.max(b,d+b);l[x]={x:p*150,y:S*75},j.push([x,p+1,S])})}Object.entries(t).filter(([c,p])=>!["linestart","lineend"].includes(c)).filter(([c,p])=>s.filterNodes((d,u)=>Object.values(H).includes(u.type)&&u[u.type].names[0]===p.localisedName.zh).length===0).map(([c,p])=>{var S,y,M;let d=H.ShmetroBasic;const u=p.transfer.groups,x=u.map(P=>{var G;return(G=P.lines)!=null?G:[]}).flat();o===ge.SHMetro?x.length>0?d=H.ShmetroInt:a===Cs.sh2020?d=H.ShmetroBasic2020:d=H.ShmetroBasic:o===ge.GZMTR?x.length>0?d=H.GzmtrInt:d=H.GzmtrBasic:o===ge.MTR&&(d=H.MTR);const b={...structuredClone(fn[d].defaultAttrs),names:[(S=p.localisedName.zh)!=null?S:"",(y=p.localisedName.en)!=null?y:""]};return d===H.ShmetroBasic2020?b.color=n:d===H.GzmtrBasic?(b.color=n,b.lineCode=i,b.stationCode=p.num):d===H.GzmtrInt?b.transfer=u.map((P,G)=>{var te,F;const he=(F=(te=P.lines)==null?void 0:te.map(V=>{var pe;return[...(pe=V.theme)!=null?pe:n,"1","01"]}))!=null?F:[];return G===0?[[...n,i,p.num],...he]:he}):d===H.MTR&&((M=u[0].lines)!=null&&M.length?b.transfer=[[[...n,"",""],...u[0].lines.map(P=>{var G;return[...(G=P.theme)!=null?G:n,"",""]})]]:b.transfer=[[]]),{node:m[c],attr:{visible:!0,zIndex:0,x:r+l[c].x,y:h+l[c].y,type:d,[d]:b}}}).forEach(({node:c,attr:p})=>s.addNode(c,p)),Object.entries(t).filter(([c,p])=>!["linestart","lineend"].includes(c)).forEach(([c,p])=>{p.children.filter(d=>!["linestart","lineend"].includes(d)).forEach(d=>{const u=ts.Diagonal,[x,b]=[m[c],m[d]],S=g?kt(s,u,x,b,"from"):-1;s.addDirectedEdgeWithKey("line_".concat(cs(10)),x,b,{visible:!0,zIndex:0,type:u,[ts.Diagonal]:structuredClone(Mt[ts.Diagonal].defaultAttrs),style:Ts.SingleColor,[Ts.SingleColor]:{color:n},reconcileId:"",parallelIndex:S})})})},Gn="rmg-bridge--",Wn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Un(s){const{isOpen:a,onClose:i}=s,{t}=L(),{preference:{autoParallel:o}}=D(b=>b.app),{svgViewBoxZoom:n,svgViewBoxMin:r}=D(b=>b.param),h=B(),g=T.isAllowAnalytics(),m=ys(),{height:j,width:l}=Ss(m),c=Fe.useRef(window.graph),[p]=Fe.useState(crypto.randomUUID()),d="/rmg/#/import?"+new URLSearchParams({parentComponent:T.getAppName(),parentId:p}),u=Fe.useCallback(()=>{h(J()),h($()),h(se(c.current.export()))},[h,J,$,se,c]),x=b=>{try{g&&T.event(_e.IMPORT_RMG_PARAM,{});const S=r.x+l*n/100/3,y=r.y+j*n/100/3;Bn(c.current,b,S,y,o),u()}catch(S){h(Je({status:"error",message:t("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",S)}finally{i()}};return Fe.useEffect(()=>{const b=new BroadcastChannel(Gn+p);return b.onmessage=S=>{const{event:y,data:M}=S.data;console.log("[rmp] Received event from RMG app clip:",y),y==="CLOSE"?i():y==="IMPORT"&&x(M)},()=>b.close()},[r.x,r.y,n,j,l,o]),e.jsx(Ks,{isOpen:a,onClose:i,sx:Wn,children:e.jsx("iframe",{src:d,loading:"lazy"})})}const $n="RMP_GALLERY_CHANNEL",Fn="OPEN_TEMPLATE",Ps=new BroadcastChannel($n),Vn={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function Jn(s){const{isOpen:a,onClose:i}=s,t=Ws(),{t:o}=L(),n=B(),{telemetry:{project:r}}=D(c=>c.app),h=T.isAllowAnalytics(),g=f.useRef(window.graph),m=f.useCallback(()=>{n(J()),n($()),n(se(g.current.export()))},[n,J,$,se,g]),j=async c=>{const{version:p,...d}=JSON.parse(await qs(JSON.stringify(c)));n(ds()),g.current.clear(),g.current.import(d.graph),m();const{svgViewBoxZoom:u,svgViewBoxMin:x}=d;typeof u=="number"&&n(Me(u)),typeof x.x=="number"&&typeof x.y=="number"&&n(Le(x))},l=async(c,p)=>{var x;const d=p?"https://".concat(p):"",u=await((x=(await Promise.allSettled([fetch("".concat(d,"/rmp-gallery/resources/real_world/").concat(c,".json")),fetch("".concat(d,"/rmp-gallery/resources/fantasy/").concat(c,".json"))])).filter(b=>b.status==="fulfilled").find(b=>b.value.status===200))==null?void 0:x.value.json());if(u){if(h){const b={id:c};r&&p&&(b.host=p),T.event(_e.IMPORT_WORK_FROM_GALLERY,b)}j(u),t({title:o("header.open.importFromRMPGallery",{id:c}),status:"success",duration:9e3,isClosable:!0})}else t({title:o("header.open.failToImportFromRMPGallery",{id:c}),status:"error",duration:9e3,isClosable:!0});T.updateAppMetadata({hash:""})};return f.useEffect(()=>{const p=new URL(window.location.href).searchParams;if(p.size>0){const d=p.keys().next().value,u=d.indexOf("."),x=d.substring(0,u===-1?void 0:u);let b;u!==-1&&(b=d.substring(u+1)),l(x,b)}},[]),f.useEffect(()=>(Ps.onmessage=c=>{const{event:p,data:d}=c.data;p===Fn&&(l(d),i())},()=>Ps.close()),[]),e.jsxs(Ks,{isOpen:a,onClose:i,size:"full",sx:Vn,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(Us,{onClick:i,position:"fixed",top:"5px",right:"15px"})]})}function Yn(){const s=B(),{t:a}=L(),i=ys(),{height:t}=Ss(i),o=f.useRef(window.graph),n=f.useRef(null),[r,h]=f.useState(!1),[g,m]=f.useState(!1),j=f.useCallback(()=>{s(J()),s($()),s(se(o.current.export()))},[s,J,$,se,o]),l=()=>{s(ds()),o.current.clear(),s(Me(100)),s(Le({x:0,y:0})),j()},c=async u=>{const{version:x,...b}=JSON.parse(await qs(u));s(ds()),o.current.clear(),o.current.import(b.graph),j();const{svgViewBoxZoom:S,svgViewBoxMin:y}=b;typeof S=="number"&&s(Me(S)),typeof y.x=="number"&&typeof y.y=="number"&&s(Le(y))},p=async u=>{var b;const x=(b=u.target.files)==null?void 0:b[0];if(console.log("OpenActions.handleUpload():: received file",x),(x==null?void 0:x.type)!=="application/json")s(Je({status:"error",message:a("header.open.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const S=await Zn(x);await c(S)}catch(S){s(Je({status:"error",message:a("header.open.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",S)}u.target.value=""},d=async()=>{await c(await Ot()),s(Le({x:-10,y:-13}));const u=Math.max(0,Math.min(400,-.132*t+117.772));s(Me(u)),T.event(_e.LOAD_TUTORIAL,{})};return f.useEffect(()=>{const u=async x=>{const{type:b,key:S,from:y}=x.data;if(b===Rt.SAVE_CHANGED&&S===Es.PARAM&&y==="rmt"){Et.debug("Received save changed event on key: ".concat(S));const M=localStorage.getItem(Es.PARAM);if(!M)return;await c(M)}};return Os.addEventListener("message",u),()=>Os.removeEventListener("message",u)},[]),e.jsxs(fs,{children:[e.jsx(js,{as:ee,size:"sm",variant:"ghost",icon:e.jsx(Rs,{})}),e.jsxs(bs,{children:[e.jsx(ce,{icon:e.jsx(_t,{}),onClick:l,children:a("header.open.new")}),e.jsx("input",{id:"upload_project",ref:n,type:"file",accept:".json",hidden:!0,onChange:p,"data-testid":"file-upload"}),e.jsx(ce,{icon:e.jsx(Rs,{}),onClick:()=>{var u;return(u=n==null?void 0:n.current)==null?void 0:u.click()},children:a("header.open.config")}),e.jsx(ce,{icon:e.jsx(At,{}),onClick:()=>h(!0),children:a("header.open.projectRMG")}),e.jsxs(ce,{icon:e.jsx(O,{}),onClick:()=>m(!0),children:[a("header.open.gallery"),e.jsx(le,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(ce,{icon:e.jsx(Tt,{}),onClick:d,children:a("header.open.tutorial")})]}),e.jsx(Un,{isOpen:r,onClose:()=>h(!1)}),e.jsx(Jn,{isOpen:g,onClose:()=>m(!1)})]})}const Zn=s=>new Promise(a=>{const i=new FileReader;i.onloadend=()=>a(i.result),i.readAsText(s)}),Kn=()=>{const[s,a]=f.useState(!1),{t:i}=L(),t=B(),o=f.useRef(window.graph),n=ys(),{width:r,height:h}=Ss(n),[g,m]=f.useState([]);f.useEffect(()=>{s&&m(o.current.nodes().filter(l=>l.startsWith("stn")).map(l=>{const c=o.current.getNodeAttributes(l),p=c.type,d=c[p].names.join("/");return{id:l,value:d}}))},[s]);const j=l=>{t(Lt(new Set([l])));const c=Math.max(0,Math.min(400,-.132*h+117.772)),{x:p,y:d}=Pt((r-300)/2,h/2,c,{x:-o.current.getNodeAttribute(l,"x"),y:-o.current.getNodeAttribute(l,"y")});t(Me(c)),t(Le({x:-p,y:-d}))};return e.jsxs($s,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(Fs,{children:e.jsx(ee,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Nt,{}),onClick:()=>a(!s)})}),e.jsx(Vs,{children:e.jsx(Js,{children:e.jsx(It,{label:i("header.search"),children:e.jsx(Ht,{data:g,displayHandler:l=>e.jsx(le,{children:l.value}),filter:(l,c)=>c.value.toLowerCase().includes(l.toLowerCase())||Object.values(c.value).some(p=>p.toLowerCase().includes(l.toLowerCase())),value:"",onChange:l=>j(l.id)})})})})]})},qn=s=>{const{isOpen:a,onClose:i}=s,t=B(),{theme:o,paletteAppClip:{output:n}}=D(p=>p.runtime),{t:r}=L(),h=f.useRef(window.graph),[g,m]=f.useState(o),[j,l]=f.useState(!1);f.useEffect(()=>{j&&n&&(m(n),l(!1))},[n==null?void 0:n.toString()]);const c=()=>{h.current.filterEdges((p,d,u,x,b,S,y)=>Ys.has(d.style)&&JSON.stringify(d[d.style].color)===JSON.stringify(g)).forEach(p=>h.current.dropEdge(p)),t($()),t(se(h.current.export())),i()};return e.jsxs(Y,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:r("header.settings.procedures.removeLines.title")}),e.jsx(X,{}),e.jsxs(Q,{children:[r("header.settings.procedures.removeLines.content"),e.jsx(Dt,{theme:g,onClick:()=>{l(!0),t(Bt(g))}})]}),e.jsxs(me,{children:[e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:r("cancel")}),e.jsx(R,{colorScheme:"red",onClick:c,children:r("remove")})]})]})]})},Xn=s=>{const{isOpen:a,onClose:i}=s,t=B(),{t:o}=L(),n=f.useRef(window.graph),[r,h]=f.useState(1),g=[{type:"input",label:o("header.settings.procedures.scale.factor"),value:r.toString(),variant:"number",onChange:j=>h(Number(j)),minW:"full"}],m=()=>{n.current.forEachNode((j,l)=>{n.current.updateNodeAttribute(j,"x",c=>(c!=null?c:0)*r),n.current.updateNodeAttribute(j,"y",c=>(c!=null?c:0)*r)}),t(J()),t($()),t(se(n.current.export())),i()};return e.jsxs(Y,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:o("header.settings.procedures.scale.title")}),e.jsx(X,{}),e.jsxs(Q,{children:[o("header.settings.procedures.scale.content"),e.jsx(ke,{fields:g})]}),e.jsxs(me,{children:[e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:o("cancel")}),e.jsx(R,{colorScheme:"red",onClick:m,children:o("apply")})]})]})]})},Qn=s=>{const{isOpen:a,onClose:i}=s,t=B(),{t:o}=L(),n=f.useRef(window.graph),[r,h]=f.useState(0),[g,m]=f.useState(0),j=[{type:"input",label:o("header.settings.procedures.translate.x"),value:r.toString(),variant:"number",onChange:c=>h(Number(c)),minW:"full"},{type:"input",label:o("header.settings.procedures.translate.y"),value:g.toString(),variant:"number",onChange:c=>m(Number(c)),minW:"full"}],l=()=>{n.current.forEachNode((c,p)=>{n.current.updateNodeAttribute(c,"x",d=>(d!=null?d:0)+r),n.current.updateNodeAttribute(c,"y",d=>(d!=null?d:0)+g)}),t(J()),t($()),t(se(n.current.export())),i()};return e.jsxs(Y,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:o("header.settings.procedures.translate.title")}),e.jsx(X,{}),e.jsxs(Q,{children:[o("header.settings.procedures.translate.content"),e.jsx(ke,{fields:j})]}),e.jsxs(me,{children:[e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:o("cancel")}),e.jsx(R,{colorScheme:"red",onClick:l,children:o("apply")})]})]})]})},er=s=>{const{isOpen:a,onClose:i}=s,t=B(),{preference:{unlockSimplePathAttempts:o}}=D(g=>g.app),{activeSubscriptions:n}=D(g=>g.account),{t:r}=L(),h=()=>{t(Gt(-1))};return e.jsxs(Y,{isOpen:a,onClose:i,size:"5xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:r("header.settings.procedures.unlockSimplePath.title")}),e.jsx(X,{}),e.jsxs(Q,{children:[e.jsx(w,{mb:"2",children:r("header.settings.procedures.unlockSimplePath.content1")}),e.jsx(w,{mb:"2",children:r("header.settings.procedures.unlockSimplePath.content2")}),e.jsx(w,{mb:"2",children:r("header.settings.procedures.unlockSimplePath.content3")})]}),e.jsx(me,{children:e.jsx(ze,{label:r("header.settings.pro"),isOpen:!n.RMP_CLOUD&&o>=0,children:e.jsx(R,{onClick:h,isDisabled:!n.RMP_CLOUD||o<0,children:o>=0?r("header.settings.procedures.unlockSimplePath.check"):r("header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},sr=s=>{const{isOpen:a,onClose:i}=s,t=B(),o=Ws(),{t:n}=L(),r=f.useRef(window.graph),[h,g]=f.useState(!1),m=async()=>{g(!0);const j=JSON.stringify(r.current.export());try{const l=await rr(j);r.current.clear(),r.current.import(l),t(J()),t($()),t(se(r.current.export())),o({title:n("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(l){console.error("[rmp] Error in updating all colors: ".concat(l)),o({title:n("header.settings.procedures.updateColor.error",{e:l}),status:"error",duration:9e3,isClosable:!0})}g(!1),i()};return e.jsxs(Y,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:n("header.settings.procedures.updateColor.title")}),e.jsx(X,{}),e.jsx(Q,{children:e.jsx(w,{children:n("header.settings.procedures.updateColor.content")})}),e.jsxs(me,{children:[e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:n("cancel")}),e.jsx(R,{colorScheme:"red",onClick:m,isLoading:h,children:n("apply")})]})]})]})},Ds=s=>s.length>=4&&s.every(a=>typeof a=="string")&&!!s[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(ws).includes(s[3]),tr=s=>{const a=[],i=(t,o)=>{if(Array.isArray(t)&&Ds(t)){a.push({path:o||"",value:t});return}for(const n in t){const r=t[n],h=o?"".concat(o,".").concat(n):n;Array.isArray(r)?Ds(r)?a.push({path:h,value:r}):r.forEach((g,m)=>i(g,"".concat(h,".").concat(m))):r&&typeof r=="object"&&i(r,h)}};return i(s),a},nr=(s,a,i)=>{const t=a.split(".");let o=s;for(let n=0;n<t.length-1;n++)o=o[t[n]];o[t[t.length-1]]=i},rr=async s=>{const a=JSON.parse(s),i=new Date().getTime(),t=tr(a);console.log("[rmp] Found all themes pending for update",t);const o=1e4;let n,r=!1;const h=new Promise((g,m)=>{n=setTimeout(()=>{r=!0,m("Executing time exceeds ".concat(o,"ms"))},o),(async()=>{for(const{path:j,value:l}of t){if(r)throw new Error("Update aborted");const[c,p,d,u,...x]=l,b=await Wt([c,p,d,u]);nr(a,j,[...b,...x])}})().then(g).catch(m)});try{return await h,console.log("[rmp] Themes update completed, elapsed time ".concat((new Date().getTime()-i)/1e3," sec")),a}finally{clearTimeout(n)}},Bs=1,or=()=>{const s=B(),{state:a,token:i}=D(j=>j.account),{t}=L(),[o,n]=f.useState(!1),[r,h]=f.useState(Bs);f.useEffect(()=>{let j;return o&&r>0?j=window.setTimeout(()=>{h(r-1)},1e3):r===0&&n(!1),()=>clearTimeout(j)},[o,r]);const g=()=>{n(!0),h(Bs),i&&$t(s,i)},m={"logged-out":t("header.settings.subscription.logged-out"),free:t("header.settings.subscription.free"),subscriber:t("header.settings.subscription.subscriber"),expired:t("header.settings.subscription.expired")};return e.jsxs(_,{width:"100%",mb:"3",children:[e.jsx(w,{as:"b",fontSize:"xl",children:t("header.settings.subscription.title")}),e.jsx(_,{mt:"3",children:e.jsxs(_,{display:"flex",mb:"1",children:[e.jsx(w,{flex:"1",children:m[a]}),e.jsx(ee,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:e.jsx(Ut,{}),isDisabled:o,onClick:()=>g()})]})})]})},je={width:"100%",justifyContent:"space-between"},ae={fontFamily:"-apple-system"},ir=s=>{const{isOpen:a,onClose:i}=s,{activeSubscriptions:t}=D(E=>E.account),{telemetry:{project:o},preference:{autoParallel:n,randomStationsNames:r,gridLines:h}}=D(E=>E.app),{keepLastPath:g,parallelLinesCount:m}=D(E=>E.runtime),j=B(),{t:l}=L(),c=Gs("primary.500","primary.300"),[p,d]=f.useState(!1),[u,x]=f.useState(!1),[b,S]=f.useState(!1),[y,M]=f.useState(!1),[P,G]=f.useState(!1),[he,te]=f.useState(!1),[F,V]=f.useState(!1),pe=T.isAllowAnalytics(),Be=E=>{j(sn(E))},Ge=t.RMP_CLOUD?Ft:Vt,We=m>=Ge,Ae=!t.RMP_CLOUD,Ze=E=>{j(en(E.target.value))};return e.jsxs(Y,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Z,{}),e.jsxs(K,{children:[e.jsx(q,{children:l("header.settings.title")}),e.jsx(X,{}),e.jsx(Q,{children:e.jsxs(Ne,{divider:e.jsx(xt,{borderColor:"gray.200"}),children:[e.jsx(or,{}),e.jsxs(_,{width:"100%",mb:"3",children:[e.jsx(w,{as:"b",fontSize:"xl",children:l("header.settings.preference.title")}),e.jsxs(_,{mt:"3",children:[e.jsxs(_,{display:"flex",mb:"1",children:[e.jsx(w,{flex:"1",children:l("header.settings.preference.keepLastPath")}),e.jsx(Re,{isChecked:g,onChange:({target:{checked:E}})=>j(Jt(E))})]}),e.jsxs(_,{display:"flex",mb:"1",children:[e.jsx(w,{children:l("header.settings.preference.autoParallel")}),e.jsx(le,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ze,{label:l("header.settings.proWithTrial"),children:e.jsx(le,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsx(Re,{ml:"1",isDisabled:We,isChecked:n,onChange:({target:{checked:E}})=>j(Yt(E))})]}),e.jsxs(_,{mb:"1",display:"flex",children:[e.jsx(w,{flex:"1",children:l("header.settings.preference.randomStationNames.title")}),e.jsx(le,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ze,{label:l("header.settings.pro"),children:e.jsx(le,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsxs(ht,{size:"xs",width:"auto",ml:"1",value:r,onChange:Ze,children:[e.jsx("option",{value:"none",children:l("header.settings.preference.randomStationNames.none")}),e.jsx("option",{value:$e.Shmetro,disabled:Ae,children:l("header.settings.preference.randomStationNames.".concat($e.Shmetro))}),e.jsx("option",{value:$e.Bjsubway,disabled:Ae,children:l("header.settings.preference.randomStationNames.".concat($e.Bjsubway))})]})]}),e.jsxs(_,{display:"flex",mb:"1",children:[e.jsx(w,{flex:"1",children:l("header.settings.preference.gridline")}),e.jsx(Re,{isChecked:h,onChange:({target:{checked:E}})=>j(Zt(E))})]})]})]}),e.jsxs(_,{width:"100%",mb:"3",children:[e.jsx(w,{as:"b",fontSize:"xl",children:l("header.settings.procedures.title")}),e.jsxs(_,{mt:"3",children:[e.jsx(R,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>d(!0),children:l("header.settings.procedures.translate.title")}),e.jsx(Qn,{isOpen:p,onClose:()=>d(!1)}),e.jsx(R,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>x(!0),children:l("header.settings.procedures.scale.title")}),e.jsx(Xn,{isOpen:u,onClose:()=>x(!1)}),e.jsxs(R,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>S(!0),children:[l("header.settings.procedures.changeType.title"),e.jsx(ze,{label:l("header.settings.pro"),children:e.jsx(le,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(bn,{isOpen:b,onClose:()=>S(!1),isSelect:!1}),e.jsx(R,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>M(!0),children:l("header.settings.procedures.removeLines.title")}),e.jsx(qn,{isOpen:y,onClose:()=>M(!1)}),e.jsx(R,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>G(!0),children:l("header.settings.procedures.updateColor.title")}),e.jsx(sr,{isOpen:P,onClose:()=>G(!1)}),e.jsxs(R,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>te(!0),children:[l("header.settings.procedures.unlockSimplePath.title"),e.jsx(ze,{label:l("header.settings.pro"),children:e.jsx(le,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(er,{isOpen:he,onClose:()=>te(!1)}),e.jsx(R,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>V(!0),children:l("header.settings.procedures.masterManager.title")}),e.jsx(jn,{isOpen:F,onClose:()=>V(!1)})]})]}),e.jsxs(_,{width:"100%",mb:"3",children:[e.jsx(w,{as:"b",fontSize:"xl",children:l("header.settings.shortcuts.title")}),e.jsx(_,{mt:"3",children:e.jsxs(pt,{children:[e.jsx(ut,{children:e.jsxs(W,{children:[e.jsx(_s,{children:l("header.settings.shortcuts.keys")}),e.jsx(_s,{children:l("header.settings.shortcuts.description")})]})}),e.jsxs(gt,{children:[e.jsxs(W,{children:[e.jsx(k,{children:e.jsx(C,{children:"f"})}),e.jsx(k,{children:l("header.settings.shortcuts.f")})]}),e.jsxs(W,{children:[e.jsx(k,{children:e.jsx(C,{children:"s"})}),e.jsx(k,{children:l("header.settings.shortcuts.s")})]}),e.jsxs(W,{children:[e.jsx(k,{children:e.jsxs(_,{display:"flex",flexDirection:"row",children:[e.jsx(Kt,{}),e.jsx(qt,{}),e.jsx(Xt,{}),e.jsx(Qt,{})]})}),e.jsx(k,{children:l("header.settings.shortcuts.arrows")})]}),e.jsxs(W,{children:[e.jsx(k,{children:e.jsxs(_,{display:"flex",flexDirection:"row",children:[e.jsx(C,{children:"i"}),e.jsx(C,{children:"j"}),e.jsx(C,{children:"k"}),e.jsx(C,{children:"l"})]})}),e.jsx(k,{children:l("header.settings.shortcuts.ijkl")})]}),e.jsxs(W,{children:[e.jsx(k,{children:ue?e.jsx(C,{sx:ae,children:"⇧"}):e.jsx(C,{children:"shift"})}),e.jsx(k,{children:l("header.settings.shortcuts.shift")})]}),e.jsxs(W,{children:[e.jsx(k,{children:ue?e.jsx(C,{sx:ae,children:"⌥"}):e.jsx(C,{children:"alt"})}),e.jsx(k,{children:l("header.settings.shortcuts.alt")})]}),e.jsxs(W,{children:[e.jsx(k,{children:ue?e.jsx(C,{sx:ae,children:"⌫"}):e.jsx(C,{children:"delete"})}),e.jsx(k,{children:l("header.settings.shortcuts.delete")})]}),e.jsxs(W,{children:[e.jsxs(k,{children:[ue?e.jsx(C,{sx:ae,children:"⌘"}):e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"x"})]}),e.jsx(k,{children:l("header.settings.shortcuts.cut")})]}),e.jsxs(W,{children:[e.jsxs(k,{children:[ue?e.jsx(C,{sx:ae,children:"⌘"}):e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"c"})]}),e.jsx(k,{children:l("header.settings.shortcuts.copy")})]}),e.jsxs(W,{children:[e.jsxs(k,{children:[ue?e.jsx(C,{sx:ae,children:"⌘"}):e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"v"})]}),e.jsx(k,{children:l("header.settings.shortcuts.paste")})]}),e.jsxs(W,{children:[e.jsxs(k,{children:[ue?e.jsx(C,{sx:ae,children:"⌘"}):e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"z"})]}),e.jsx(k,{children:l("header.settings.shortcuts.undo")})]}),e.jsxs(W,{children:[e.jsx(k,{children:ue?e.jsxs(e.Fragment,{children:[e.jsx(C,{sx:ae,children:"⇧"})," + ",e.jsx(C,{sx:ae,children:"⌘"})," + ",e.jsx(C,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"y"})]})}),e.jsx(k,{children:l("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(_,{width:"100%",mb:"3",children:[e.jsx(w,{as:"b",fontSize:"xl",children:l("header.settings.telemetry.title")}),e.jsxs(_,{mt:"3",children:[e.jsx(w,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.info")}),e.jsxs(_,{mt:"3",mb:"1",children:[e.jsxs(_,{display:"flex",mb:"1",children:[e.jsx(w,{flex:"1",children:l("header.settings.telemetry.essential")}),e.jsx(ze,{label:l("header.settings.telemetry.essentialTooltip"),children:e.jsx(Re,{isChecked:pe,isDisabled:!0})})]}),e.jsx(w,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.essentialInfo")}),e.jsxs(A,{color:c,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[l("header.settings.telemetry.essentialLink")," ",e.jsx(N,{as:O})]})]}),e.jsxs(_,{mt:"1",mb:"1",children:[e.jsxs(_,{display:"flex",children:[e.jsx(w,{flex:"1",children:l("header.settings.telemetry.additional")}),e.jsx(Re,{isChecked:o,onChange:({target:{checked:E}})=>Be(E)})]}),e.jsx(w,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},ar=()=>{const[s,a]=f.useState(!1),{svgViewBoxZoom:i}=D(n=>n.param),t=B(),o=[{type:"slider",label:"",value:400-i,min:10,max:390,step:1,onChange:n=>t(Me(400-n)),leftIcon:e.jsx(tn,{}),rightIcon:e.jsx(Ns,{}),minW:160}];return e.jsxs($s,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(Fs,{children:e.jsx(ee,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Ns,{}),onClick:()=>a(!s)})}),e.jsx(Vs,{children:e.jsx(Js,{children:e.jsx(ke,{fields:o,noLabel:!0})})})]})};function lr(){const{t:s}=L(),a=B(),{past:i,future:t}=D(d=>d.param),o=T.isAllowAnalytics(),[n,r]=f.useState(!1),[h,g]=f.useState(!1),m=Hs(T.getEnv),j=Hs(T.getAppVersion);f.useEffect(()=>{o&&m!==ns.DEV&&T.event(_e.APP_LOAD,{isStandaloneWindow:T.isStandaloneWindow()})},[m]);const l=d=>{T.getI18nInstance().changeLanguage(d)},c=()=>{a(hn()),a(J()),a($())},p=()=>{a(pn()),a(J()),a($())};return e.jsxs(nn,{children:[e.jsx(Ce,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rmp")}),e.jsx(rn,{environment:m,version:j,popoverHeader:m===ns.PRD?void 0:e.jsxs(Is,{i18nKey:"header.popoverHeader",environment:m,children:["You're on ",{environment:m}," environment!"]}),popoverBody:m===ns.PRD?void 0:e.jsx(Is,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(mt,{ml:"auto",children:[e.jsx(ie,{children:e.jsx(Kn,{})}),e.jsx(ie,{children:e.jsx(ee,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(on,{}),isDisabled:i.length===0,onClick:c})}),e.jsx(ie,{children:e.jsx(ee,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(an,{}),isDisabled:t.length===0,onClick:p})}),e.jsx(ie,{children:e.jsx(ar,{})}),e.jsx(ie,{children:e.jsx(Yn,{})}),e.jsx(ie,{children:e.jsx(Dn,{})}),T.isStandaloneWindow()&&e.jsx(ie,{children:e.jsxs(fs,{children:[e.jsx(js,{as:ee,icon:e.jsx(ln,{}),variant:"ghost",size:"sm"}),e.jsx(bs,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(d=>e.jsx(ce,{onClick:()=>l(d),children:wn[d][d]},d))})]})}),e.jsx(ie,{children:e.jsx(ee,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(cn,{}),onClick:()=>r(!0)})}),e.jsx(ie,{children:e.jsx(ee,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(dn,{}),onClick:()=>g(!0)})})]}),e.jsx(ir,{isOpen:n,onClose:()=>r(!1)}),e.jsx(Sn,{isOpen:h,onClose:()=>g(!1)})]})}function cr(){const s=B(),a=D(t=>t.runtime.globalAlerts),i=t=>{T.isStandaloneWindow()?window.open("/".concat(t),"_blank"):T.openApp({appId:t})};return e.jsx(e.Fragment,{children:Object.entries(a).map(([t,{message:o,url:n,linkedApp:r}])=>e.jsxs(ft,{status:t,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(jt,{}),r?e.jsx(A,{onClick:()=>i(r),children:o}):n?e.jsx(A,{href:n,target:"_blank",children:o}):o,e.jsx(Us,{ml:"auto",onClick:()=>s(un(t))})]},t))})}function xr(){return e.jsxs(e.Fragment,{children:[e.jsx(lr,{}),e.jsx(cr,{})]})}export{xr as default};
