System.register(["./chakra-legacy-DsJcG_7N.js","./index-legacy-CKg3D7KT.js","./react-legacy-S3BmMPiz.js","./clipboard-legacy-Dddlt6N0.js","./master-manager-legacy-DmddqoRb.js","./change-type-modal-legacy-Bi8yFeWH.js","./tools-legacy-vh8FZzIz.js","./misc-nodes-legacy-ClIinVYX.js"],(function(e,t){"use strict";var n,i,s,r,a,l,d,o,c,u,p,h,g,m,x,f,b,j,y,w,v,A,S,N,E,C,z,k,W,O,I,P,R,T,D,L,_,F,M,U,$,V,B,H,K,q,G,J,Q,X,Y,Z,ee,te,ne,ie;return{setters:[e=>{n=e.j,i=e.B,s=e.aw,r=e.ax,a=e.aK,l=e.O,d=e.aM,o=e.U,c=e.D,u=e._,p=e.$,h=e.a0,g=e.a1,m=e.a3,x=e.a5,f=e.a4},e=>{b=e.c,j=e.d,y=e.aE,w=e.T,v=e.az,A=e.aF,S=e.t,N=e.v,E=e.l,C=e.au,z=e.k,k=e.o,W=e.P,O=e.aG,I=e.q,P=e.S,R=e.$,T=e.a0,D=e.i,L=e.m,_=e.y,F=e.aA,M=e.aD,U=e.aH,$=e.aI,V=e.aJ,B=e.aK,H=e.av,K=e.n},e=>{q=e.u,G=e.b},e=>{J=e.u,Q=e.e},e=>{X=e.s},e=>{Y=e.C,Z=e.c,ee=e.a,te=e.b},e=>{ne=e.LearnHowToAdd},e=>{ie=e.m}],execute:function(){function t(){const{t:e}=q(),t=b(),{selected:u}=j((e=>e.runtime)),p=G.useRef(window.graph),h=e=>{if(p.current.hasNode(e)){const t=p.current.getNodeAttributes(e),n=t.type;return e.startsWith("stn")?t[n].names.join("/"):n}if(p.current.hasEdge(e)){const[t,n]=p.current.extremities(e),i=p.current.getSourceAttributes(e),s=p.current.getTargetAttributes(e),r=i.type,a=s.type;return(t.startsWith("stn")?i[r].names[0]:r)+" - "+(n.startsWith("stn")?s[a].names[0]:a)}},[g,m]=G.useState([]);G.useEffect((()=>{m(["station","misc-node","line"])}),[u]);const[x,f]=G.useState(!1);return n.jsxs(i,{children:[n.jsxs(s,{as:"h5",size:"sm",children:[e("panel.details.multipleSelection.selected")," ",u.size]}),n.jsxs(r,{m:"var(--chakra-space-1)",children:[n.jsxs(a,{w:"100%",children:[n.jsx(s,{as:"h5",size:"xs",w:"100%",children:e("panel.details.multipleSelection.show")}),n.jsx(y,{selections:[{label:e("panel.details.multipleSelection.station"),value:"station"},{label:e("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:e("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:g,multiSelect:!0,onChange:e=>m(e)})]}),0!==g.length&&n.jsxs(n.Fragment,{children:[n.jsxs(l,{width:"100%",size:"sm",onClick:()=>f(!0),children:[e("panel.details.multipleSelection.change"),n.jsx(d,{label:e("header.settings.pro"),children:n.jsx(o,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),n.jsx(c,{})]}),[...u].filter((e=>g.includes("station")||!e.startsWith("stn"))).filter((e=>g.includes("misc-node")||!e.startsWith("misc"))).filter((e=>g.includes("line")||!e.startsWith("line"))).map((e=>{var i;return n.jsxs(a,{width:"100%",children:[n.jsx(l,{width:"100%",size:"sm",variant:"solid",onClick:()=>t(w(new Set([e]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:null===(i=h(e))||void 0===i?void 0:i.replaceAll("\n","⏎")}),n.jsx(l,{size:"sm",onClick:()=>t(v(e)),children:n.jsx(A,{})})]},e)}))]}),n.jsx(Y,{isOpen:x,onClose:()=>f(!1),isSelect:!0,filter:g})]})}function se(){const{t:e}=q(),t=b(),i=G.useCallback((()=>{t(S()),t(N(o.current.export()))}),[t,S,N]),{preference:{autoParallel:s}}=j((e=>e.app)),{selected:r,theme:a}=j((e=>e.runtime)),[d]=r,o=G.useRef(window.graph),[c,f]=G.useState(!1),y=G.useRef(null),w=Object.fromEntries(Object.entries(E).map((([t,n])=>[t,e(n.metadata.displayName).toString()]))),[v,A]=G.useState(o.current.getEdgeAttribute(d,"type")),[I,P]=G.useState(void 0),R=Object.fromEntries(Object.entries(C).map((([t,n])=>[t,e(n.metadata.displayName).toString()]))),[T,D]=G.useState(o.current.getEdgeAttribute(d,"style")),[L,_]=G.useState(void 0);G.useEffect((()=>{A(o.current.getEdgeAttribute(d,"type")),D(o.current.getEdgeAttribute(d,"style"))}),[d]);const F=Object.values(z).filter((e=>!C[T].metadata.supportLinePathType.includes(e))),M=Object.values(k).filter((e=>!C[e].metadata.supportLinePathType.includes(v))),U=e=>{e&&(I?(I&&(Z(o.current,d,I,s),A(o.current.getEdgeAttribute(d,"type")),i()),P(void 0)):L&&(L&&(ee(o.current,d,L,a),D(o.current.getEdgeAttribute(d,"style")),i()),_(void 0))),f(!1)};return n.jsxs(n.Fragment,{children:[n.jsx(W,{label:e("panel.details.info.linePathType"),minW:"276",children:n.jsx(O,{options:w,disabledOptions:F,defaultValue:v,value:v,onChange:({target:{value:e}})=>{P(e),f(!0)}})}),n.jsx(W,{label:e("panel.details.info.lineStyleType"),minW:"276",children:n.jsx(O,{options:R,disabledOptions:M,defaultValue:T,value:T,onChange:({target:{value:e}})=>{_(e),f(!0)}})}),n.jsx(ne,{type:"line",expand:!0}),n.jsx(u,{isOpen:c,leastDestructiveRef:y,onClose:()=>U(!1),children:n.jsx(p,{children:n.jsxs(h,{children:[n.jsx(g,{children:e("warning")}),n.jsx(m,{children:e("panel.details.changeLineTypeContent")}),n.jsxs(x,{children:[n.jsx(l,{ref:y,onClick:()=>U(!1),children:e("cancel")}),n.jsx(l,{ml:"2",colorScheme:"red",onClick:()=>U(!0),children:e("panel.details.changeType")})]})]})})})]})}function re(){const{t:e}=q(),t=b(),i=G.useCallback((()=>{t(I()),t(N(d.current.export()))}),[t,I,N]),{selected:s,refresh:{nodes:r}}=j((e=>e.runtime)),[a]=s,d=G.useRef(window.graph),[o,c]=G.useState(!1),f=G.useRef(null),[y,w]=G.useState(void 0),[v,A]=G.useState(P.ShmetroBasic);G.useEffect((()=>{if(null!=a&&a.startsWith("stn")){const e=d.current.getNodeAttribute(a,"type");A(e)}}),[r,s]);const S=Object.fromEntries(Object.entries(X).map((([t,n])=>[t,e(n.metadata.displayName).toString()]))),E=e=>{e&&y&&(te(d.current,a,y),i()),w(void 0),c(!1)};return n.jsxs(n.Fragment,{children:[n.jsx(W,{label:e("panel.details.info.stationType"),minW:"276",children:n.jsx(O,{options:S,disabledOptions:[v],value:v,onChange:({target:{value:e}})=>{w(e),c(!0)}})}),n.jsx(u,{isOpen:o,leastDestructiveRef:f,onClose:()=>E(!1),children:n.jsx(p,{children:n.jsxs(h,{children:[n.jsx(g,{children:e("warning")}),n.jsx(m,{children:e("panel.details.changeStationTypeContent")}),n.jsxs(x,{children:[n.jsx(l,{ref:f,onClick:()=>E(!1),children:e("cancel")}),n.jsx(l,{ml:"2",colorScheme:"red",onClick:()=>E(!0),children:e("panel.details.changeType")})]})]})})})]})}function ae(){const{t:e}=q(),r=b(),a=G.useCallback((()=>{r(I()),r(S()),r(N(u.current.export()))}),[r,I,S,N]),{activeSubscriptions:l}=j((e=>e.account)),{selected:d,parallelLinesCount:o}=j((e=>e.runtime)),[c]=d,u=G.useRef(window.graph),p=e=>{u.current.setEdgeAttribute(c,"parallelIndex",e),r(S()),r(N(u.current.export()))},h=[];if(0===d.size);else if(1===d.size){if(h.push({type:"input",label:e("panel.details.info.id"),value:c,minW:276}),h.push({type:"select",label:e("panel.details.info.zIndex"),value:c?u.current.hasNode(c)?u.current.getNodeAttribute(c,"zIndex"):u.current.hasEdge(c)?u.current.getEdgeAttribute(c,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},((e,t)=>[t-10,(t-10).toString()]))),onChange:e=>(e=>{const t=Math.min(Math.max(e,-10),10);u.current.hasNode(c)&&u.current.setNodeAttribute(c,"zIndex",t),u.current.hasEdge(c)&&u.current.setEdgeAttribute(c,"zIndex",t),a()})(Number(e))}),u.current.hasEdge(c)){const t=u.current.getEdgeAttributes(c),{parallelIndex:n,type:i}=t,s=l.RMP_CLOUD?R:T,r=o>s&&n<0||i===z.Simple,a=o>s&&n>=0;h.push({type:"switch",label:e("panel.details.info.parallel"),isDisabled:r,isChecked:n>=0,onChange:e=>((e,t)=>{let n=-1;if(e){const e=u.current.getEdgeAttributes(c),[i,s]=u.current.extremities(c);n=L(u.current,e.type,i,s,t)}p(n)})(e,t[t.type].startFrom),oneLine:!0,minW:276}),n>=0&&h.push({type:"input",label:e("panel.details.info.parallelIndex"),variant:"number",isDisabled:a,value:t.parallelIndex.toString(),onChange:e=>p(Number(e)),minW:276})}}else d.size>1&&h.push({type:"input",label:e("panel.details.info.type"),value:e("panel.details.multipleSelection.title"),minW:276});return n.jsxs(i,{p:1,children:[n.jsx(s,{as:"h5",size:"sm",children:e("panel.details.info.title")}),n.jsx(D,{fields:h,minW:130}),1===d.size&&c.startsWith("stn")&&u.current.hasNode(c)&&u.current.getNodeAttribute(c,"type")in X&&n.jsx(re,{}),1===d.size&&c.startsWith("line")&&u.current.hasEdge(c)&&u.current.getEdgeAttribute(c,"type")in E&&u.current.getEdgeAttribute(c,"style")in C&&n.jsx(se,{}),d.size>1&&n.jsx(t,{})]})}function le(){const{t:e}=q(),t=b(),{selected:r}=j((e=>e.runtime)),[a]=r,d=G.useRef(window.graph),[o,c]=G.useState("undefined"),[u,p]=G.useState("undefined"),[h,g]=G.useState("undefined"),[m,x]=G.useState("undefined");G.useEffect((()=>{if(null!=a&&a.startsWith("line")){const[s,r]=d.current.extremities(a);if(c(s),p(r),s.startsWith("stn")){var e,t;const n=d.current.getNodeAttribute(s,"type");g(null!==(e=null===(t=d.current.getNodeAttribute(s,n))||void 0===t?void 0:t.names.at(0))&&void 0!==e?e:"undefined")}if(r.startsWith("stn")){var n,i;const e=d.current.getNodeAttribute(r,"type");x(null!==(n=null===(i=d.current.getNodeAttribute(r,e))||void 0===i?void 0:i.names.at(0))&&void 0!==n?n:"undefined")}}}),[r]);const f=J((()=>{t(_()),t(F(o))})),y=J((()=>{t(_()),t(F(u))})),w=[{type:"custom",label:e("panel.details.lineExtremities.source"),component:n.jsx(l,{ml:"auto",size:"sm",variant:"link",onClick:f,children:o}),oneLine:!0,minW:"full"},{type:"input",label:e("panel.details.lineExtremities.sourceName"),value:h,minW:"full"},{type:"custom",label:e("panel.details.lineExtremities.target"),component:n.jsx(l,{ml:"auto",size:"sm",variant:"link",onClick:y,children:u}),oneLine:!0,minW:"full"},{type:"input",label:e("panel.details.lineExtremities.targetName"),value:m,minW:"full"}];return n.jsxs(i,{p:1,children:[n.jsx(s,{as:"h5",size:"sm",children:e("panel.details.lineExtremities.title")}),n.jsx(D,{fields:w,minW:130})]})}function de(){const{t:e}=q(),t=b(),r=G.useCallback((()=>{t(I()),t(S()),t(N(o.current.export()))}),[t,I,S,N]),{selected:a,refresh:{nodes:l}}=j((e=>e.runtime)),[d]=a,o=G.useRef(window.graph),[c,u]=G.useState({x:0,y:0});G.useEffect((()=>{if(null!=d&&d.startsWith("stn")||null!=d&&d.startsWith("misc_node_")){const e=o.current.getNodeAttribute(d,"x"),t=o.current.getNodeAttribute(d,"y");u({x:e,y:t})}}),[l,a]);const p=[{type:"input",label:e("panel.details.nodePosition.pos.x"),value:c.x.toString(),validator:e=>!Number.isNaN(e),onChange:e=>{o.current.mergeNodeAttributes(d,{x:Number(e)}),r()}},{type:"input",label:e("panel.details.nodePosition.pos.y"),value:c.y.toString(),validator:e=>!Number.isNaN(e),onChange:e=>{o.current.mergeNodeAttributes(d,{y:Number(e)}),r()}}];return n.jsxs(i,{p:1,children:[n.jsx(s,{as:"h5",size:"sm",children:e("panel.details.nodePosition.title")}),n.jsx(D,{fields:p,minW:130})]})}const oe={...X,...ie},ce=()=>{var e;const t=b(),{selected:i}=j((e=>e.runtime)),{t:s}=q(),[r]=i,a=window.graph.getNodeAttribute(r,"type"),l=a in oe&&oe[a].attrsComponent,d=null!==(e=window.graph.getNodeAttribute(r,a))&&void 0!==e?e:{};return l?n.jsx(l,{id:r,attrs:d,handleAttrsUpdate:(e,n)=>{const i=window.graph.getNodeAttribute(e,"type");window.graph.mergeNodeAttributes(e,{[i]:n}),t(I()),t(N(window.graph.export()))}}):n.jsx(f,{fontSize:"xs",m:"var(--chakra-space-1)",children:s("panel.details.unknown.error",{category:s("panel.details.unknown.node")})})},ue=()=>{var e,t;const i=b(),{preference:{autoParallel:s}}=j((e=>e.app)),{selected:r}=j((e=>e.runtime)),{t:a}=q(),[l]=r,{type:d,style:o,parallelIndex:c,reconcileId:u}=window.graph.getEdgeAttributes(l),p=null!==(e=window.graph.getEdgeAttribute(l,d))&&void 0!==e?e:{},h=d in E&&E[d].attrsComponent,g=null!==(t=window.graph.getEdgeAttribute(l,o))&&void 0!==t?t:{},m=o in C&&C[o].attrsComponent;return n.jsxs(n.Fragment,{children:[h?n.jsx(h,{id:l,attrs:p,recalculateParallelIndex:(e,t)=>{let n=-1;if(s){const[i,s]=window.graph.extremities(e);n=L(window.graph,d,i,s,t)}window.graph.setEdgeAttribute(e,"parallelIndex",n)},handleAttrsUpdate:(e,t)=>{window.graph.mergeEdgeAttributes(e,{[d]:t}),i(S()),i(N(window.graph.export()))},parallelIndex:c}):n.jsx(f,{fontSize:"xs",m:"var(--chakra-space-1)",children:a("panel.details.unknown.error",{category:a("panel.details.unknown.linePath")})}),m?n.jsx(m,{id:l,attrs:g,handleAttrsUpdate:(e,t)=>{window.graph.mergeEdgeAttributes(e,{[o]:t}),i(S()),i(N(window.graph.export()))},reconcileId:u}):n.jsx(f,{fontSize:"xs",m:"var(--chakra-space-1)",children:a("panel.details.unknown.error",{category:a("panel.details.unknown.lineStyle")})})]})};e("default",(()=>{const{t:e}=q(),t=b(),r=G.useRef(window.graph),d=G.useCallback((()=>{t(I()),t(S()),t(N(r.current.export()))}),[t,I,S,N]),{activeSubscriptions:o}=j((e=>e.account)),{selected:c,mode:u,active:p,masterNodesCount:h}=j((e=>e.runtime)),[g]=c,m=!o.RMP_CLOUD&&h+1>M;return n.jsxs(U,{isOpen:c.size>0&&!u.startsWith("line")&&!p,width:300,header:"Dummy header",alwaysOverlay:!0,children:[n.jsx($,{onClose:()=>t(_()),children:e("panel.details.header")}),n.jsxs(V,{children:[n.jsx(ae,{}),1===c.size&&r.current.hasNode(g)&&n.jsx(de,{}),1===c.size&&r.current.hasEdge(g)&&n.jsx(le,{}),1===c.size&&n.jsxs(i,{p:1,children:[n.jsx(s,{as:"h5",size:"sm",children:e("panel.details.specificAttrsTitle")}),window.graph.hasNode(g)&&n.jsx(ce,{}),window.graph.hasEdge(g)&&n.jsx(ue,{})]})]}),n.jsx(B,{children:n.jsxs(a,{children:[1===c.size&&r.current.hasNode(g)&&n.jsx(l,{size:"sm",variant:"outline",onClick:()=>(e=>{const n=structuredClone(r.current.getNodeAttributes(e));n.x+=50,n.y+=50;const i=e.startsWith("stn")?`stn_${K(10)}`:`misc_node_${K(10)}`;r.current.addNode(i,n),t(I()),t(N(r.current.export()))})(g),isDisabled:r.current.getNodeAttributes(g).type===H.Master&&m,children:e("panel.details.footer.duplicate")}),n.jsx(l,{size:"sm",variant:"outline",onClick:()=>(e=>{const t=Q(r.current,e);navigator.clipboard.writeText(t)})(c),children:e("panel.details.footer.copy")}),n.jsx(l,{size:"sm",variant:"outline",onClick:()=>{return e=c,t(_()),e.forEach((e=>{r.current.hasNode(e)?r.current.dropNode(e):r.current.hasEdge(e)&&r.current.dropEdge(e)})),void d();var e},children:e("panel.details.footer.remove")})]})})]})}))}}}));
