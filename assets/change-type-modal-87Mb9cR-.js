import{j as c,at as ge,$ as fe,au as ye,a1 as me,a4 as G,a2 as be,a3 as Se,aM as Te,aN as Ae,aO as Ce,B as xe,aP as je,aQ as Ee,a5 as Oe,O as Q}from"./chakra-sjIlidOs.js";import{S as V,ac as T,m as F,L as b,o as ee,f as ve,a as Le,q as $,t as J,v as K,C as Ne,c as Ie,l as we,_ as Pe,R as Be,T as Re,H as Me,j as We}from"./index-T4U4Ur6A.js";import{u as ze,b as r}from"./react-hBmrxY6U.js";import{c as ke}from"./graph-BkNs-_ad.js";import{s as S}from"./stations-Xuob-wJv.js";const U=[V.ShmetroBasic2020],Ze=(a,s,o)=>{const i=a.getNodeAttribute(s,"type"),n=structuredClone(a.getNodeAttribute(s,i).names);for(let l=0;l<Math.abs(S[o].defaultAttrs.names.length-n.length);l++)S[o].defaultAttrs.names.length>n.length?n.push("Stn"):n.pop();const t={...S[o].defaultAttrs,names:n};(!Object.values(U).includes(i)||!Object.values(U).includes(o))&&(t.nameOffsetX=a.getNodeAttribute(s,i).nameOffsetX,t.nameOffsetY=a.getNodeAttribute(s,i).nameOffsetY),a.removeNodeAttribute(s,i),a.mergeNodeAttributes(s,{type:o,[o]:t})},_e=(a,s,o,i)=>i.filter(n=>s==="any"||a.getNodeAttribute(n,"type")===s).forEach(n=>{Ze(a,n,o)}),De=(a,s,o)=>{const i=a.getEdgeAttribute(s,"type"),n=a.getEdgeAttribute(s,"style");if(T[n].metadata.supportLinePathType.includes(o)){a.removeEdgeAttribute(s,i);const t=structuredClone(F[o].defaultAttrs);a.mergeEdgeAttributes(s,{type:o,[o]:t})}},He=(a,s,o,i)=>i.filter(n=>s==="any"||a.getEdgeAttribute(n,"type")===s).forEach(n=>{De(a,n,o)}),qe=(a,s,o,i)=>{const n=a.getEdgeAttribute(s,"type"),t=a.getEdgeAttribute(s,"style");if(T[o].metadata.supportLinePathType.includes(n)){const l=a.getEdgeAttribute(s,"zIndex"),h=a.getEdgeAttribute(s,t);a.removeEdgeAttribute(s,t);const p=structuredClone(T[o].defaultAttrs);b.includes(t)&&b.includes(o)?p.color=h.color:b.includes(o)&&i&&(p.color=i),a.mergeEdgeAttributes(s,{style:o,[o]:p}),o===ee.River?a.setEdgeAttribute(s,"zIndex",-5):a.setEdgeAttribute(s,"zIndex",l!=null?l:0)}},Xe=(a,s,o,i,n)=>n.filter(t=>s==="any"||a.getEdgeAttribute(t,"style")===s).forEach(t=>{qe(a,t,o,i)}),Ye=(a,s,o,i)=>i.filter(n=>b.includes(a.getEdgeAttribute(n,"style"))).forEach(n=>{const t=a.getEdgeAttributes(n),l=t[t.style].color;(s==="any"||l[0]==s[0]&&l[1]==s[1]&&l[2]==s[2]&&l[3]==s[3])&&a.mergeEdgeAttributes(n,{[t.style]:{color:o}})}),Ge=(a,s,o,i,n)=>{[...i,...n].forEach(t=>{const l=a.getNodeAttributes(t).type,h=a.getNodeAttribute(t,l);if(h.color!==void 0){const p=h.color;(s==="any"||p[0]==s[0]&&p[1]==s[1]&&p[2]==s[2]&&p[3]==s[3])&&(h.color=o)}a.mergeNodeAttributes(t,{[l]:h})})},Qe=(a,s,o,i,n)=>{[...s,...o].forEach(t=>{a.setNodeAttribute(t,"zIndex",n)}),i.forEach(t=>{a.setEdgeAttribute(t,"zIndex",n)})},Fe=a=>{const{isOpen:s,onClose:o,isSelect:i,filter:n}=a,{t}=ze(),l=ve(),{selected:h,theme:p,paletteAppClip:{output:y}}=Le(e=>e.runtime),te=r.useCallback(()=>{l($()),l(J()),l(K(u.current.export()))},[l,$,J,K]),u=r.useRef(window.graph),R={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(F).map(([e,d])=>[e,t(d.metadata.displayName).toString()]))},M={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(T).map(([e,d])=>[e,t(d.metadata.displayName).toString()]))},W={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(S).map(([e,d])=>[e,t(d.metadata.displayName).toString()]))},A={id:"any",theme:[Ne.Other,"other","#ffffff",Ie.black],value:t("header.settings.procedures.changeType.any")},[C,z]=r.useState(!1),[k,Z]=r.useState(0),[x,_]=r.useState(!1),[j,se]=r.useState("any"),[E,ne]=r.useState(V.ShmetroBasic),[O,D]=r.useState(!1),[v,ae]=r.useState("any"),[L,oe]=r.useState(ee.SingleColor),[N,H]=r.useState(!1),[I,ie]=r.useState("any"),[w,ce]=r.useState(we.Diagonal),[P,q]=r.useState(!1),[m,X]=r.useState(A),[B,le]=r.useState(p),[re,Y]=r.useState(!1);r.useEffect(()=>{re&&y&&(le(y),Y(!1))},[y==null?void 0:y.toString()]);const[de,ue]=r.useState([]),he=[{id:"changeZIndex",title:t("header.settings.procedures.changeZIndex"),onClose:()=>z(!C),field:[{type:"select",label:t("panel.details.info.zIndex"),value:k,options:Object.fromEntries(Array.from({length:11},(e,d)=>[d-5,(d-5).toString()])),onChange:e=>Z(Number(e))}]},{id:"changeStationType",title:t("header.settings.procedures.changeStationType.title"),onClose:()=>_(!x),field:[{type:"select",label:t("header.settings.procedures.changeStationType.changeFrom"),options:W,value:j,disabledOptions:[E],onChange:e=>se(e)},{type:"select",label:t("header.settings.procedures.changeStationType.changeTo"),options:W,value:E,disabledOptions:["any",j],onChange:e=>ne(e)}]},{id:"changeLineStyleType",title:t("header.settings.procedures.changeLineStyleType.title"),onClose:()=>D(!O),field:[{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeFrom"),options:M,value:v,disabledOptions:[L],onChange:e=>ae(e)},{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeTo"),options:M,value:L,disabledOptions:["any",v],onChange:e=>oe(e)}]},{id:"changeLinePathType",title:t("header.settings.procedures.changeLinePathType.title"),onClose:()=>H(!N),field:[{type:"select",label:t("header.settings.procedures.changeLinePathType.changeFrom"),options:R,value:I,disabledOptions:[w],onChange:e=>ie(e)},{type:"select",label:t("header.settings.procedures.changeLinePathType.changeTo"),options:R,value:w,disabledOptions:["any","simple",I],onChange:e=>ce(e)}]},{id:"changeColor",title:t("header.settings.procedures.changeColor.title"),onClose:()=>q(!P),field:[{type:"custom",label:t("header.settings.procedures.changeColor.changeFrom"),component:c.jsx(Pe,{data:de,displayHandler:e=>c.jsx(Be,{name:e.value,fg:e.theme[3],bg:e.theme[2],title:e.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(e,d)=>d.id.toLowerCase().includes(e.toLowerCase())||Object.values(d.id).some(f=>f.toLowerCase().includes(e.toLowerCase())),value:m.value,onChange:e=>X(e)})},{type:"custom",label:t("header.settings.procedures.changeColor.changeTo"),component:c.jsx(Re,{theme:B,onClick:()=>{Y(!0),l(Me(p))}})}]}];r.useEffect(()=>{s&&(z(!1),_(!1),D(!1),H(!1),q(!1),Z(0),ue([A,...ke(u.current,i?[...h].filter(e=>e.startsWith("stn")||e.startsWith("misc_node")):u.current.nodes(),i?[...h].filter(e=>e.startsWith("line")):u.current.edges()).map(e=>({id:e.toString(),theme:e,value:e[1]==="other"?e[2]:e[1]}))]),X(A))},[s]);const pe=()=>{const e=n!=null&&n.includes("station")?[...h].filter(g=>g.startsWith("stn")):i?[]:u.current.filterNodes(g=>g.startsWith("stn")),d=n!=null&&n.includes("misc-node")?[...h].filter(g=>g.startsWith("misc_node")):i?[]:u.current.filterNodes(g=>g.startsWith("misc_node")),f=i?[...h].filter(g=>g.startsWith("line")):u.current.edges();(!n||n.includes("station"))&&x&&_e(u.current,j,E,e),(!n||n.includes("line"))&&O&&Xe(u.current,v,L,p,f),(!n||n.includes("line"))&&N&&He(u.current,I,w,f),P&&((!n||n.includes("line"))&&Ye(u.current,m.id==="any"?"any":m.theme,B,f),(!n||n.includes("misc-node")||n.includes("station"))&&Ge(u.current,m.id==="any"?"any":m.theme,B,e,d)),C&&Qe(u.current,e,d,f,k),te(),o()};return c.jsxs(ge,{isOpen:s,onClose:o,size:"md",scrollBehavior:"inside",children:[c.jsx(fe,{}),c.jsxs(ye,{children:[c.jsxs(me,{children:[c.jsx(G,{as:"b",fontSize:"xl",children:t(i?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),c.jsx(be,{})]}),c.jsx(Se,{children:c.jsx(Te,{allowMultiple:!0,children:he.map(e=>c.jsxs(Ae,{children:[c.jsxs(Ce,{onClick:e.onClose,children:[c.jsx(xe,{as:"span",flex:"1",textAlign:"left",children:c.jsx(G,{as:"b",fontSize:"md",children:e.title})}),c.jsx(je,{})]}),c.jsx(Ee,{pb:4,children:c.jsx(We,{fields:e.field,minW:270})})]},e.id))})}),c.jsxs(Oe,{children:[c.jsx(Q,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:t("cancel")}),c.jsx(Q,{colorScheme:"red",mr:"1",onClick:pe,isDisabled:!C&&!x&&!O&&!N&&!P,children:t("apply")})]})]})]})};export{Fe as C,qe as a,Ze as b,De as c};
